<!DOCTYPE html>
<html lang="en">
<head>
  <title>Period Calculater</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://kit.fontawesome.com/9b619cdf6b.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .calendar-table {
      border-collapse: collapse;
      margin: 20px auto;
      width: 60%;
    }
    .calendar-table th,
    .calendar-table td {
      border: 1px solid #999;
      text-align: center;
      padding: 10px;
      width: 14.2%;
      height: 20px;
    }
    .calendar-header-day {
      background-color: #FEDEDF;
      font-weight: bold;
    }
    .calendar-day {
      background-color: #FEDEDF
    }
    .monthLabel {
      font-size: 20px;
      text-align: center;
      background: #FEDEDF;
      padding: 10px;
    }
    
    .calendar-table tr th:first-child,
    .calendar-table tr th:last-child,
    .calendar-table tr td:first-child,
    .calendar-table tr td:last-child {
      color: #FF4455;
    }

    .container {
      width: 100vw;
      height: 500px;
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    td.active {
      background-color: #FF4455;
      color: #fff;
    }

    td.calendar-day:hover {
      cursor: pointer;
    }

    td.next {
      cursor: initial!important;
    }

    .btn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      color: #fff;
      background-color: #711D20; 
      border-radius: 0px;   
    }
    
    .btn:hover {
      background-color: #923236;
    }

    .bth-circle {
      position: relative;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #711D20;  
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      border:none;
    }

    .center {
      position: absolute ;
      right: 35%;
    }

    .bth-circle:hover {
      background-color: #923236;
    }

    #num-days, #num-diff {
      font-size: 64px;
      margin: 0 60px;
      min-width: 30px;
      text-align: center;
    }

    #start-next-p, #end-next-p {
      color: #FF4455;
    }

    li {
      border: #711D20 1px solid !important;
    }

    li.active {
      background-color: #711D20 !important;
    }

    .carousel-indicators {
      bottom: -50px;
    }


  </style>
</head>
<body>

<div id="myCarousel" class="carousel slide" data-ride="carousel" data-bs-touch="false" data-bs-interval="false">

  <div class="carousel-inner">
    <div class="item active" style="text-align: center;">
      <div class="container">
        <h2>วันแรกของประจำเดือนเริ่มขึ้นเมื่อไหร่ ?</h2>
          <div style="display: flex; text-align:center; gap:10px;">
              <select id="select-month" name="select-month">
              </select>
              <select id="select-year" name="select-year">
              </select>
              <input type="hidden" id="select-date" name="select-date" value="">
          </div>
          <div id="calendar"></div>
      </div>
  
      <button class="btn first-form" href="#myCarousel" data-slide="next">ถัดไป<i style="margin-left: 10px;" class="fa-solid fa-angle-right"></i></button>
    </div>

    <div class="item" style="text-align: center;">
      <div class="container" >
        <h2>จำนวนวันที่ประจำเดือนมา</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button class="bth-circle" onclick="handleMinusDate('num-days','num-days-input')"><i style="margin-left: 10px;" class="fa-solid fa-angle-left center"></i></button>
          <p id="num-days">5</p>
          <button class="bth-circle" onclick="handleAddDate('num-days','num-days-input')"><i style="margin-left: 10px;" class="fa-solid fa-angle-right center"></i></button>
          <input type="hidden" id="num-days-input" value="5">
        </div>
      </div>
      <div>
          <button class="btn" href="#myCarousel" data-slide="prev" ><i style="margin-right: 10px;" class="fa-solid fa-angle-left"></i>ย้อนกลับ</button>
          <button class="btn" href="#myCarousel" data-slide="next" >ถัดไป<i style="margin-left: 10px;" class="fa-solid fa-angle-right"></i></button>
      </div>
    </div>

    <div class="item" style="text-align: center;">
      <div class="container">
        <h2>ความยาวรอบเดือนเฉลี่ย</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
          <button class="bth-circle" onclick="handleMinusDate('num-diff', 'num-diff-input')"><i style="margin-left: 10px;" class="fa-solid fa-angle-left center"></i></button>
          <p id="num-diff">28</p>
          <button class="bth-circle" onclick="handleAddDate('num-diff', 'num-diff-input')"><i style="margin-left: 10px;" class="fa-solid fa-angle-right center"></i></button>
          <input type="hidden" id="num-diff-input" value="28">
        </div>
      </div>
      <div>
          <button class="btn" href="#myCarousel" data-slide="prev"><i style="margin-right: 10px;" class="fa-solid fa-angle-left"></i>ย้อนกลับ</button>
          <button class="btn" href="#myCarousel" data-slide="next" onclick="calNextPeriod()">คำนวณ</button>
      </div>
    </div>

    <div class="item" style="text-align: center;"> 
      <div class="container">
        <h2>ระยะเวลาประจำเดือนรอบถัดไปของคุณ</h2>
        <h1 id="start-next-p"></h1>
        <h3>ถึง</h3>
        <h1 id="end-next-p"></h1>
      </div>
      <button class="btn" id="start-over" href="#myCarousel" data-slide="next">เริ่มใหม่</button>
    </div>
  </div>

</div>

<script>
  $(document).ready(function(){
    $('#myCarousel').carousel({
      interval: false // Disable auto-sliding
    });

  });
</script>

<script>
//Hide First Button
$(document).ready(function() {
  var $firstBtn = $('.btn.first-form');
  var $selectDate = $('#select-date');

  $firstBtn.hide();

  $selectDate.on('change', function() {
    var selectedDate = $(this).val();
    if (selectedDate) {
      $firstBtn.show();
    } else {
      $firstBtn.hide();
    }
  });
});
</script>

<script>

// --- Calendar Data ---
    cal_days_labels = ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'];
    // cal_months_labels = ['January', 'February', 'March', 'April','May', 'June', 'July', 'August', 'September','October', 'November', 'December'];
    cal_months_labels = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน','พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน','ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];
    cal_days_in_month = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    cal_current_date = new Date();

function calNextPeriod() {
  // Get Input Values
  var inputs = document.querySelectorAll('input');
  if (inputs.length < 3) {
    throw new Error('Input Not Sufficient');
  }
  var data = {};
  inputs.forEach(input => {
    data[input.id] = input.value;
  });

  console.log(data);

  var startDate = data['select-date'];
  var numDays = parseInt(data['num-days-input'], 10);
  var numDiff = parseInt(data['num-diff-input'], 10);

  // Calculate Next Period
  var nextPeriod = new Date(startDate);
  nextPeriod.setDate(nextPeriod.getDate() + numDiff);
  var endPeriod = new Date(nextPeriod);
  endPeriod.setDate(endPeriod.getDate() + numDays - 1);

  // Format day & month in Thai
  const startDay = `${nextPeriod.getDate()} ${nextPeriod.toLocaleString('th-TH', { month: 'long' })} ${nextPeriod.getFullYear()}`;
  const endDay = `${endPeriod.getDate()} ${endPeriod.toLocaleString('th-TH', { month: 'long' })} ${endPeriod.getFullYear()}`;

  console.log('Next Period Start Date: ' + startDay);
  console.log('Next Period End Date: ' + endDay);

  document.getElementById('start-next-p').textContent = startDay;
  document.getElementById('end-next-p').textContent = endDay;

}

// --- Reset Value ---
  function resetValue() {
    document.getElementById('select-date').value = '';
    document.getElementById('num-days-input').value = '5';
    document.getElementById('num-days').textContent = '5';
    document.getElementById('num-diff-input').value = '28';
    document.getElementById('num-diff').textContent = '28';
    var tds = document.querySelectorAll('.calendar-day');
    tds.forEach(td => {
      td.classList.remove('active');
    });

    var $firstBtn = $('.btn.first-form');
    $firstBtn.hide();

    calendar = new Calendar(cal_current_date.getMonth(), cal_current_date.getFullYear());
    calendar.generateHTML();
    document.getElementById('calendar').innerHTML = calendar.getHTML();
    var tds = document.querySelectorAll('.calendar-day');
    tds.forEach(td => {
       //check if td is not empty
      if (td.textContent.trim() !== '') {
        td.addEventListener('click', handleSelectDate);
      } else {
        td.style.cursor = 'default';
      }
    });
  }

  document.getElementById('start-over').addEventListener('click', function() {
    resetValue();
  } );

// --- Handle Add / Minus Date ---
  function handleAddDate(elementDisplay, elementInput) {
    var numDaysElement = document.getElementById(elementDisplay);
    var numDaysVal = parseInt(numDaysElement.textContent, 10);
    if (numDaysVal < 40) { 
      numDaysVal += 1;
      numDaysElement.textContent = numDaysVal;
      document.getElementById(elementInput).value = numDaysVal;
    }
  }

  function handleMinusDate(elementDisplay, elementInput) {
    var numDaysElement = document.getElementById(elementDisplay);
    var numDaysVal = parseInt(numDaysElement.textContent, 10);
    if (numDaysVal > 1) { 
      numDaysVal -= 1;
      numDaysElement.textContent = numDaysVal;
      document.getElementById(elementInput).value = numDaysVal;
    }
  }

// --- Render the select month ---
    var monthSelect = document.getElementById('select-month');
    for(var i=0; i<cal_months_labels.length; i++){  
      var option = document.createElement("option");
      option.value = i;
      option.text = cal_months_labels[i];
      if(i === cal_current_date.getMonth()){
        option.selected = true;
      }
      monthSelect.appendChild(option);
    }

    monthSelect.addEventListener('change', function() {     
      var selectedMonth = parseInt(this.value);
      var selectedYear = parseInt(document.getElementById('select-year').value);
      var calendar = new Calendar(selectedMonth, selectedYear);
      calendar.generateHTML();
      document.getElementById('calendar').innerHTML = calendar.getHTML();
      var tds = document.querySelectorAll('.calendar-day');
      tds.forEach(td => {
         //check if td is not empty
        if (td.textContent.trim() !== '') {
          td.addEventListener('click', handleSelectDate);
        } else {
          td.style.cursor = 'default';
        }
      });

      var $firstBtn = $('.btn.first-form');
      $firstBtn.hide();
    });

// --- Render the select year ---
    var yearSelect = document.getElementById('select-year');  
    var startYear = cal_current_date.getFullYear() - 1;
    var endYear = cal_current_date.getFullYear() + 1;   
    for(var i=startYear; i<=endYear; i++){  
      var option = document.createElement("option");
      option.value = i;
      option.text = i;
      if(i === cal_current_date.getFullYear()){
        option.selected = true;
      }
      yearSelect.appendChild(option);
    }  

    yearSelect.addEventListener('change', function() {     
      var selectedYear = parseInt(this.value);
      var selectedMonth = parseInt(document.getElementById('select-month').value);
      var calendar = new Calendar(selectedMonth, selectedYear);
      calendar.generateHTML();
      document.getElementById('calendar').innerHTML = calendar.getHTML();
      var tds = document.querySelectorAll('.calendar-day');
      tds.forEach(td => {
         //check if td is not empty
        if (td.textContent.trim() !== '') {
          td.addEventListener('click', handleSelectDate);
        } else {
          td.style.cursor = 'default';
        }
      });

      var $firstBtn = $('.btn.first-form');
      $firstBtn.hide();
    });


// --- Render Calendar ---
    function Calendar(month, year) {
      this.month = (isNaN(month) || month == null) ? cal_current_date.getMonth() : month;
      this.year  = (isNaN(year) || year == null) ? cal_current_date.getFullYear() : year;
      this.html = '';
    }

    Calendar.prototype.generateHTML = function(){
      var firstDay = new Date(this.year, this.month, 1);
      var startingDay = firstDay.getDay();
      var monthLength = cal_days_in_month[this.month];

      if (this.month == 1) { 
        if((this.year % 4 == 0 && this.year % 100 != 0) || this.year % 400 == 0){
          monthLength = 29;
        }
      }

      var monthName = cal_months_labels[this.month];
      var html = '<table class="calendar calendar-table ' + monthName + ' days-label">';
      html += '<tr class="header"><th colspan="7" class="monthLabel">';
      html += monthName + " " + this.year;
      html += '</th></tr>';
      html += '<tr class="header calendar-header">';
      for(var i = 0; i <= 6; i++ ){
        html += '<td class="calendar-header-day daysLabel currentMonth day">';
        html += cal_days_labels[i];
        html += '</td>';
      }
      html += '</tr><tr>';

      var day = 1;
      for (var i = 0; i < 9; i++) {
        for (var j = 0; j <= 6; j++) {
          var day2 = (day <=9 ) ? '0' + day : day;
          var month2 = (this.month <9 ) ? '0' + (this.month+1) : this.month+1;
          html += '<td class="calendar-day" data-date="' + this.year + '-' + month2 + '-' + day2 + '">';
          if (day <= monthLength && (i > 0 || j >= startingDay)) {
            html += day;
            day++;
          }
          html += '</td>';
        }
        if (day > monthLength) {
          if(i<5){
            html += "<tr>";
            for(a=0;a<7;a++){
              html += '<td class="calendar-day" data-date="06-01"></td>';
            }
            html += "</tr>";
          }
          break;
        } else {
          html += '</tr><tr>';
        }
      }
      html += '</tr></table>';
      this.html = html;
    }

    Calendar.prototype.getHTML = function() {
      return this.html;
    }

// --- Render Current Period Calendar ---
    var calendar = new Calendar();
    calendar.generateHTML();  
    document.getElementById('calendar').innerHTML = calendar.getHTML();

    var tds = document.querySelectorAll('.calendar-day');
    tds.forEach(td => {
        //check if td is not empty
        if (td.textContent.trim() !== '') {
          td.addEventListener('click', handleSelectDate);
        } else {
          td.style.cursor = 'default';
        }
      });

// --- Handle Select Date ---
    function handleSelectDate(event) {
        var selectedDate = event.target.getAttribute('data-date');
        document.getElementById('select-date').value = selectedDate;
        $('#select-date').val(selectedDate).trigger('change');

        var tds = document.querySelectorAll('.calendar-day');
        tds.forEach(td => {
          td.classList.remove('active');
        });
        event.target.classList.add('active');
  
        console.log(selectedDate);
    }

</script>
</body>
</html>